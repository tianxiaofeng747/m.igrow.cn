define(function(){function ut(){var n=!!u;n&&u.addEventListener("updateready",function(){if(u.status==u.UPDATEREADY){try{u.swapCache()}catch(n){}location.href=location.origin+location.pathname+"?rnd="+Math.random()+location.hash}},!1)}function ft(){var n="abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,figure,figcaption,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,small,time,video,legend";n.split(",").forEach(function(n){document.createElement(n)});et(n+"{display:block;}")}function et(n){var t=document.createElement("style");t.innerHTML=n;try{r("head").appendChild(t)}catch(i){}}function p(n){var t,i;return n?(t=n.clientWidth,i=n.clientHeight):(t=window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.offsetWidth,i=window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),{w:t,h:i}}function lt(n,i,r){if(i==="error"){t.alert(n);return}var n=n||"",i=i||"info",r,u,f='<div class="mNotice"><i class="'+i+'"><\/i><span>'+n+"<\/span><\/div>";return r="success"===i?r?r:800:r?r:3e3,u=$(f).appendTo($("body")),l(u),setTimeout(function(){u.remove()},r),u}function l(n,t,i){var u=p(),o=u.h,s=u.w,r=n.jquery?n[0]:n,h=t||r.offsetWidth,i=i||r.offsetHeight,f,e;e=Math.floor((s-h)*.5);t&&(r.style.width=t+"px");r.style.position="fixed";r.style.left=e+"px";f=Math.floor((o-i)*.45);r.style.top=f+"px"}function w(n){var t,n=n||"";return t=n.lastIndexOf("!"),t>-1&&(n=n.substring(0,t)),n}function at(n,t){var n=n||"",t=t||"";return n&&(n=w(n)+t),n}function vt(n,t){var r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()},i;/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));for(i in r)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,RegExp.$1.length==1?r[i]:("00"+r[i]).substr((""+r[i]).length)));return t}function e(n){var n=n||"",t="",i=n.split(".");return t=i[i.length-1],t.toLowerCase()}function yt(n){for(var n=n||[],i={videos:[],photos:[],audios:[],docs:[],others:[]},t,f,r,u=n.length-1;u>=0;u--)t=n[u],f=t.url||"",r=e(f),b.indexOf(r)>-1?i.videos.unshift(t):o.indexOf(r)>-1?i.photos.unshift(t):k.indexOf(r)>-1?i.audios.unshift(t):d.indexOf(r)>-1?i.docs.unshift(t):i.others.unshift(t);return i}function g(n){var i=$(n.currentTarget),h=i.find("img"),u=i.closest('[data-role="photoList"]'),t=i.attr("data-original")||h.attr("data-original")||"",c=e(t),f=t.indexOf("/assets")>-1?t:t+"!medium.640",s,r=[];o.indexOf(c)!==-1&&(u.length===0?t&&r.push(f):u.find('[data-role="photoItem"]').each(function(n,t){var i=$(t).attr("data-original")||$(t).find("img").attr("data-original")||"",u=e(i),f=i.indexOf("/assets")>-1?i:i+"!medium.640";o.indexOf(u)>-1&&r.push(f)}),window.WeixinJSBridge?seajs.use(["WeixinApi"],function(){WeixinApi.imagePreview(f,r)}):(s=i.index(),seajs.use(["imageview"],function(n){n.init(r,s)})))}function pt(n){var t=n||{},i=t.wrapper||"body",r=t.item||'[data-role="photoItem"]';$(i).off("click",r,g);$(i).on("click",r,g)}function wt(n,t,i){var o,s,f,h,u,r=new Image,e=document.body;if(r.src=n,r.complete)return t(r.width,r.height);e&&(u=document.createElement("div"),u.style.cssText="position:absolute;left:-99999px;top:0;",u.appendChild(r),e.appendChild(u),o=r.offsetWidth,s=r.offsetHeight,h=function(){(r.offsetWidth!==o||r.offsetHeight!==s)&&(clearInterval(f),t(r.offsetWidth,r.clientHeight),r.onload=null,u.innerHTML="",u.parentNode.removeChild(u))},f=setInterval(h,150));r.onload=function(){r.complete&&(t(r.width,r.height),r.onload=r.onerror=null,clearInterval(f),e&&r.parentNode&&r.parentNode.removeChild(r))};r.onerror=function(){i&&i();clearInterval(f);e&&r.parentNode&&r.parentNode.removeChild(r)}}function bt(n){var f=window.location.search;if(f.indexOf("?")!=-1){var e=f.substr(1).split("&"),t={},u=[],r="";for(i=0;i<e.length;i++)u=e[i].split("="),r=decodeURIComponent(u[0]),r.substr(-2)=="[]"?(t[r]||(t[r]=[]),t[r].push(u[1])):t[r]=u[1];return n?t[n]?t[n]:null:t}}var n=function(){var i=navigator.userAgent,t=null,r=function(n,t){var i=n.split(t);return i=i.shift()+"."+i.join(""),i*1},n={isPC:!0,ua:i,version:null,ios:!1,android:!1,windows:!1,blackberry:!1,meizu:!1,weixin:!1,wVersion:null,touchSupport:"createTouch"in document,hashSupport:!!("onhashchange"in window)},u,f;if(t=i.match(/MicroMessenger\/([\.0-9]+)/),t!=null&&(n.weixin=!0,n.wVersion=r(t[1],".")),t=i.match(/Android\s([\.0-9]+)/),t!=null)return n.isPC=!1,n.android=!0,n.version=r(t[1],"."),n.meizu=/M030|M031|M032|MEIZU/.test(i),n;if(t=i.match(/i(Pod|Pad|Phone)\;.*\sOS\s([\_0-9]+)/),t!=null)return n.isPC=!1,n.ios=!0,n.version=r(t[2],"_"),n;if(t=i.match(/Windows\sPhone\sOS\s([\.0-9]+)/),t!=null)return n.isPC=!1,n.windows=!0,n.version=r(t[1],"."),n;u={a:i.match(/\(BB1\d+\;\s.*\sVersion\/([\.0-9]+)\s/),b:i.match(/\(BlackBerry\;\s.*\sVersion\/([\.0-9]+)\s/),c:i.match(/^BlackBerry\d+\/([\.0-9]+)\s/),d:i.match(/\(PlayBook\;\s.*\sVersion\/([\.0-9]+)\s/)};for(f in u)if(u[f]!=null)return t=u[f],n.blackberry=!0,n.version=r(t[1],"."),n;return n}(),kt=n.ua,f=n.touchSupport,dt=n.hashSupport,tt=n.ios,gt=n.ios&&n.version<4.5,ni=n.android,ti=n.meizu,ii=n.android&&n.version<2.3,ri=n.android&&n.version<2.4,ui=f?"touchstart":"click",fi=f?"touchstart":"mousedown",ei=f?"touchmove":"mousemove",oi=f?"touchend":"mouseup",si=function(){var n=document.createElement("div"),t=document.createElement("div"),i=!0;return n.style.position="absolute",n.style.top="200px",t.style.position="fixed",t.style.top="100px",n.appendChild(t),document.body.appendChild(n),t.getBoundingClientRect&&t.getBoundingClientRect().top==n.getBoundingClientRect().top&&(i=!1),document.body.removeChild(n),i},hi=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":/MSIE/i.test(navigator.userAgent)?"ms":"",a="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,ci="translate"+(a?"3d(":"("),li=a?",0)":")",ai=tt&&!!(window.history&&window.history.pushState),u=window.applicationCache,vi=function(n,t,i,r,u){var f,e,o;if(typeof t=="undefined"&&(t="POST"),typeof i=="undefined"&&(i=null),typeof u=="undefined"&&(u=!0),t=t.toLowerCase(),f=null,e=[],window.ActiveXObject)f=new ActiveXObject("Microsoft.XMLHTTP");else if(window.XMLHttpRequest)f=new XMLHttpRequest;else return!1;if(f.onreadystatechange=function(){if(f.readyState==4&&(f.status==200||f.status==0)){var n=f.responseText,t=u?JSON.parse(n):n;r&&r.call(null,t)}},i)for(o in i)e.push(o+"="+i[o]);e=e.length?e.join("&"):null;t=="get"&&e!=null&&(n+=n.indexOf("?")>-1?"&":"?",n+=e,e=null);console&&console.log&&console.log("ajax: ",n,e);try{f.open(t,n,!0);t=="post"&&f.setRequestHeader("content-type","application/x-www-form-urlencoded");f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.send(e)}catch(s){throw"[ajax] request error";}return!0},r=function(n,t){if(t&&typeof t=="string")try{t=r(t)}catch(i){console.log(i);return}return(t||document).querySelector(n)},s=function(n,t){if(t&&typeof t=="string")try{t=r(t)}catch(i){console.log(i);return}return(t||document).querySelectorAll(n)},yi=function(){for(var i=0,u=arguments.length,r=[],n,t;i<u;i++)for(n=arguments[i],typeof n=="string"&&(n=s(n)),t=0;t<n.length;t++)r.push(n[t]);return r},it=function(){var n={};return{set:function(t,i){n[t]=i},get:function(t){return n[t]},clear:function(){n={}},remove:function(t){delete n[t]}}}(),v=function(){var t=window.sessionStorage,n=window.localStorage,r=function(n){var t=i(n);return t!=null?t.value:null},i=function(i){return i in t?JSON.parse(t.getItem(i)):i in n?JSON.parse(n.getItem(i)):null},u=function(t,i){var r={value:i,ts:(new Date).getTime()};r=JSON.stringify(r);n.setItem(t,i)},f=function(){n.clear()},e=function(t){n.removeItem(t)},o=function(t){var u=(new Date).getTime(),i;for(var r in n)i=v.getData(r),u-i.ts>t&&n.removeItem(r)},s=function(t,i){var r;typeof i=="object"&&(i.ts=(new Date).getTime(),r=JSON.stringify(i),n.setItem(t,r))};return{set:u,get:r,setData:s,getData:i,clear:f,remove:e,removeExpires:o}}(),rt=function(){function i(n,t){var r=encodeURIComponent,i,u=[],f=t?t:"&";for(i in n)u.push(r(i)+"="+r(n[i]));return u.join(f)}function t(n,t){var i=n.indexOf(t);return i==-1?[n,""]:[n.substring(0,i),n.substring(i+1)]}var n=function(n,i,r){var l=n||window.location.href,o=r||"&",s=t(l,i||"#"),a=s[0],h=s[1],f,u,c,e;if(this.map={},this.sign=o,h)for(f=h.split(o),u=0;u<f.length;u++)c=f[u],e=t(c,"="),this.map[e[0]]=e[1];this.size=function(){return this.keys().length};this.keys=function(){var n=[];for(var t in this.map)t!="_hashfoo_"&&n.push(t);return n};this.values=function(){var n=[];for(var t in this.map)t!="_hashfoo_"&&n.push(this.map[t]);return n};this.put("_hashfoo_",Math.random())};return n.prototype.get=function(n){return this.map[n]||null},n.prototype.put=function(n,t){this.map[n]=t},n.prototype.set=n.prototype.put,n.prototype.putAll=function(n){if(typeof n=="object")for(var t in n)this.map[t]=n[t]},n.prototype.remove=function(n){var i,t;if(this.map[n]){i={};for(t in this.map)t!=n&&(i[t]=this.map[t]);this.map=i}},n.prototype.toString=function(){var t={};for(var n in this.map)n!="_hashfoo_"&&(t[n]=this.map[n]);return i(t,"&")},n.prototype.clone=function(){return new n("foo#"+this.toString(),this.sign)},n}(),h=function(){function n(n){var t=new RegExp("\\-([a-z])","g");return t.test(n)?n.toLowerCase().replace(t,RegExp.$1.toUpperCase()):n}function t(n){return n.replace(/([A-Z])/g,"-$1").toLowerCase()}function i(n,i,r){n.setAttribute("data-"+t(i),r)}function r(n,i){var r=n.getAttribute("data-"+t(i));return r||undefined}return function(t,u,f){if(arguments.length>2)try{t.dataset[n(u)]=f}catch(e){i(t,u,f)}else try{return t.dataset[n(u)]}catch(e){return r(t,u)}}}(),y,nt,t;jQuery.extend({os:{ios:!1,android:!1,version:!1}}),function(){var n=navigator.userAgent,e=n.match(/WebKit\/([\d.]+)/),r=n.match(/(Android)\s+([\d.]+)/),t=n.match(/(iPad).*OS\s([\d_]+)/),i=n.match(/(iPod).*OS\s([\d_]+)/),u=!i&&!t&&n.match(/(iPhone\sOS)\s([\d_]+)/),f=n.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),o=f&&n.match(/TouchPad/),s=n.match(/Kindle\/([\d.]+)/),h=n.match(/Silk\/([\d._]+)/),c=n.match(/(BlackBerry).*Version\/([\d.]+)/),l=n.match(/MQQBrowser\/([\d.]+)/),a=n.match(/CriOS\/([\d.]+)/),v=n.match(/Opera\/([\d.]+)/),y=n.match(/Safari\/([\d.]+)/);r&&(jQuery.os.android=!0,jQuery.os.version=r[2]);u&&(jQuery.os.ios=jQuery.os.iphone=!0,jQuery.os.version=u[2].replace(/_/g,"."));t&&(jQuery.os.ios=jQuery.os.ipad=!0,jQuery.os.version=t[2].replace(/_/g,"."));i&&(jQuery.os.ios=jQuery.os.ipod=!0,jQuery.os.version=i[2].replace(/_/g,"."))}();y={success:function(){var n="成功了",i=1e3,t,r,u;arguments.length===3?(n=arguments[0],i=arguments[1],t=arguments[2]):arguments.length===2?(n=arguments[0],i=typeof arguments[1]=="number"?arguments[1]:i,t=typeof arguments[1]=="function"?arguments[1]:null):arguments.length==1&&(n=typeof arguments[0]=="string"?arguments[0]:n,t=typeof arguments[0]=="function"?arguments[0]:null);u='<div id="mLoading" role="success"><div class="lbk"><\/div><div class="lcont">'+n+"<\/div><\/div>";$("#mLoading").remove();r=$(u).appendTo($("body"));l($("#mLoading"),146,146);setTimeout(function(){r.remove();t&&t()},i)},show:function(n,t){var n=n||"正在加载...",t=t||{},i='<div id="mLoading"><div class="lbk"><\/div><div class="lcont">'+n+"<\/div><\/div>";$("#mLoading").length>0?$("#mLoading .lcont").text(n):($("body").append(i),l($("#mLoading"),146,146))},hide:function(){$("#mLoading").remove()}};var b=["3gp","mov","mp4","ogg","avi"],o=["jpg","png","gif","bmp","jpeg"],k=["mp3","wav"],d=["doc","xls","ppt","docx","xlsx","pptx","pdf"];return ut(),ft(),nt='<div class="m-dialog" style=""><div class="m-content"><div class="m-txt"><\/div><\/div><div class="m-footer"><button class="m-btn" data-role="ok"><\/button><button class="m-btn" data-role="cancel"><\/button><\/div><\/div>',t=window.Utils={videoTypes:b,photoTypes:o,audioTypes:k,docTypes:d,alert:function(n,i){var r={dialogClass:"m-alert-dialog",content:n,ok:i,okClass:"m-btn-danger m-one-btn",btnCancel:!1};t.dialog(r)},confirm:function(n,i){var r={content:n,ok:i,okClass:"m-btn-danger"};t.dialog(r)},dialog:function(n){setTimeout(function(){t._dialog(n)},5)},_dialog:function(n){var t=n||{},c=(new Date).valueOf(),w=t.dialogClass||"",r=t.autoClose||!1,e=t.id||"m_dialog_"+c,o="m_modal_"+c,b=t.modal===!1?!1:!0,l=t.btnOk===!1?!1:!0,a=t.btnCancel===!1?!1:!0,k=t.okText||"确认",d=t.cancelText||"取消",v=t.okClass||"m-btn-success",y=t.cancelClass||"",g=t.content||"",p=$("body"),i,u,f;$(".m-dialog-modal, .m-dialog").remove();b&&$('<div class="m-modal m-dialog-modal" id="'+o+'"><\/div>').appendTo(p);i=$(nt).appendTo(p);i.addClass(w).attr("id",e);i.find(".m-txt").html(g);u=i.find('[data-role="ok"]');f=i.find('[data-role="cancel"]');l?(u.text(k),v&&u.addClass(v),u.bind("click",function(){t.ok&&t.ok();$(".m-dialog-modal, .m-dialog").remove()})):u.remove();a?(f.text(d),y&&f.addClass(y),f.bind("click",function(){t.cancel&&t.cancel();$(".m-dialog-modal, .m-dialog").remove()})):f.remove();l||a||i.find(".m-footer").remove();var tt=jQuery(window).width(),it=jQuery(window).height(),s=(tt-i.outerWidth())/2,h=(it-i.height())*.382;s=t.left||s;h=t.top||h;i.css({top:h+"px",left:s+"px"});r&&(r=r>1?r:1e3,setTimeout(function(){jQuery("#"+e).fadeOut("slow",function(){jQuery("#"+o).hide();jQuery("#"+o).remove();jQuery("#"+e).hide();jQuery("#"+e).remove();typeof t.closeCallback=="function"&&t.closeCallback()})},r))},getNoRepeat:function(n,t){for(var n=n||[],u=[],f={},i,t=t||"id",r=0;r<n.length;r++)i=n[r],f[i[t]]||(u.push(i),f[i[t]]=!0);return u},removeItem:function(n,t,i){for(var n=n||[],t=t||{},i=i||"id",f,u=-1,r=0;r<n.length;r++)if(f=n[r],t[i]==f[i]){u=r;break}u!==-1&&n.splice(u,1)},getItem:function(n,t){var n=n||[],e,r=[],i=[],f,u;if(typeof t=="object"){for(u in t)r.push(t[u]);for(r=r.join(""),f=0;f<n.length;f++){e=n[f];i=[];for(u in t)i.push(e[u]);if(i=i.join(""),i===r)return e}return null}return null},strlen:function(n){return/msie/.test(navigator.userAgent.toLowerCase())&&n.indexOf("\n")!==-1?n.replace(/\r?\n/g,"_").length:n.length},mb_strlen:function(n){for(var i=0,t=0;t<n.length;t++)i+=n.charCodeAt(t)<0||n.charCodeAt(t)>255?3:1;return i},mb_cutstr:function(n,t,i){var f=0,u="",i=!i&&i!==""?"...":i,r;for(t=t-i.length,r=0;r<n.length;r++){if(f+=n.charCodeAt(r)<0||n.charCodeAt(r)>255?1:1,f>t){u+=i;break}u+=n.substr(r,1)}return u},strLenCalc:function(n,i,r){for(var u=n.value,r=r?r:200,f=r,o=t.strlen(u),e=0;e<u.length;e++)f-=1;jQuery("#"+i).html(Math.floor(f))},strLenCalc2:function(n,i,r){for(var u=n.value,r=r?r:200,e=r,o=t.strlen(u),f=0;f<u.length;f++)e-=u.charCodeAt(f)<0||u.charCodeAt(f)>127?2:1;jQuery("#"+i).html(Math.floor(e/2))},timerId:!1,initTouch:function(n){function s(t){var f=t.touches[0];r=f.pageY;e=f.pageX;u=f.pageX;i=f.pageY;typeof n.start=="function"&&n.start(t)}function h(f){var h=Math.max(document.body.scrollTop,document.documentElement.scrollTop),s;window.clearInterval(t.timerId);touch=f.touches[0];u=touch.pageX;i=touch.pageY;h<=0&&r-i<=0&&jQuery.os.ios&&f.preventDefault();typeof n.move=="function"&&(s={x:e-u,y:r-i},n.move(f,s));jQuery.os.ios||(t.timerId=window.setTimeout(function(){o()},50))}function o(t){if(typeof n.end=="function"){var f={x:e-u,y:r-i};n.end(t,f)}}var f=n.obj||document,e,r,u,i;f.addEventListener("touchstart",s,!1);f.addEventListener("touchmove",h,!1);jQuery.os.ios&&f.addEventListener("touchend",o,!1)},formatNewsTime:function(n){var r=(new Date).valueOf(),i="",t=(r-n)/1e3;return t<60?i="刚刚":t<3600?i=Math.floor(t/60)+"分钟前":t<86400?i=Math.floor(t/3600)+"小时前":t<2592e3?i=Math.floor(t/86400)+"天前":t<31104e3?i=Math.floor(t/2592e3)+"个月前":t>=31104e3&&(i=Math.floor(t/31104e3)+"年前"),i},mLoading:y,mNotice:lt,bindPreviewPhoto:pt,classifyAttachment:yt,getFileExt:e,getQuery:bt,imgReady:wt,formatDate:vt,env:n,MCache:it,MStorage:v,MData:h,MURLHash:rt,addPhotoSuffix:at,removePhotoSuffix:w},t});
//# sourceMappingURL=utils.min.js.map
